<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Community Flood Risk Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="app-header">
    <div class="header-text">
      <h1 data-i18n="header.title">Community Flood Risk Dashboard</h1>
      <p class="tagline" data-i18n="header.tagline">Understand flood exposure, find shelters, and plan insurance coverage.</p>
    </div>
    <div class="language-switcher">
      <label class="sr-only" for="language-select" data-i18n="language.label">Language</label>
      <select id="language-select" class="language-select">
        <option value="en" data-i18n="language.options.en">English</option>
        <option value="es" data-i18n="language.options.es">Español</option>
        <option value="zh" data-i18n="language.options.zh">中文</option>
      </select>
    </div>
  </header>

  <div id="container" class="app-main">
    <section class="map-panel">
      <div id="map"></div>
        <div class="legend-panel">
        <details class="legend-accordion">
          <summary class="legend-accordion__summary" data-i18n="legend.floodLayers">Flood Zone Layers</summary>
          <div class="legend-accordion__content">
            <p data-i18n="legend.instruction">Select zones to display on the map.</p>
            <div id="layer-toggles" class="layer-toggle-list"></div>
          </div>
        </details>
        <div class="legend-scale">
          <h3 data-i18n="legend.zoneGuide">Zone Guide</h3>
          <ul>
            <li><span class="legend-swatch zone-ve"></span> <span data-i18n="legend.zones.VE">VE &mdash; Coastal flood with wave action</span></li>
            <li><span class="legend-swatch zone-ae"></span> <span data-i18n="legend.zones.AE">AE &mdash; High risk (Base Flood Elevation)</span></li>
            <li><span class="legend-swatch zone-ao"></span> <span data-i18n="legend.zones.AO">AO &mdash; River/stream flood, depth 1-3 ft</span></li>
            <li><span class="legend-swatch zone-a"></span> <span data-i18n="legend.zones.A">A &mdash; High risk (no Base Flood Elevation)</span></li>
            <li><span class="legend-swatch zone-x"></span> <span data-i18n="legend.zones.X">X &mdash; Moderate or minimal risk</span></li>
            <li><span class="legend-swatch legend-shelter"></span> <span data-i18n="legend.shelter">Shelters</span></li>
          </ul>
        </div>
        <div class="legend-scale parcel-scale">
          <h3 data-i18n="legend.parcelTitle">Parcel Value per sq. meter</h3>
          <div class="parcel-gradient">
            <span class="parcel-min" data-i18n="legend.parcelLowDefault">Low</span>
            <div class="parcel-gradient-bar"></div>
            <span class="parcel-max" data-i18n="legend.parcelHighDefault">High</span>
          </div>
        </div>
      </div>
    </section>

    <aside class="info-panel" id="info-panel">
      <div class="info-search">
        <form id="parcel-search-form" class="parcel-search" autocomplete="off">
          <label class="sr-only" for="parcel-search-input" data-i18n="search.label">Search parcel name</label>
          <input
            type="search"
            id="parcel-search-input"
            name="parcel-search"
            placeholder="Search parcel name…"
            data-i18n-placeholder="search.placeholder"
            aria-describedby="parcel-search-feedback"
          >
          <button type="submit" data-i18n="search.button">Search</button>
        </form>
        <p id="parcel-search-feedback" class="search-feedback" aria-live="polite"></p>
      </div>

      <section class="info-section" id="risk-section">
        <h2 data-i18n="info.riskTitle">My Flood Risk</h2>
        <div class="info-body">
          <p class="info-placeholder" data-i18n="info.riskPlaceholder">Click on the map to explore flood zone details for your location.</p>
        </div>
      </section>

      <section class="info-section" id="shelter-section">
        <h2 data-i18n="info.shelterTitle">Where to Go During Flood</h2>
        <div class="info-body">
          <p class="info-placeholder" data-i18n="info.shelterPlaceholder">We will list the nearest shelter and travel distance.</p>
        </div>
      </section>

      <section class="info-section" id="insurance-section">
        <h2 data-i18n="info.insuranceTitle">Flood Insurance Guide</h2>
        <div class="info-body">
          <p class="info-placeholder" data-i18n="info.insurancePlaceholder">Get a quick estimate of insurance needs based on your property value and flood risk.</p>
        </div>
      </section>
    </aside>
  </div>

  <footer class="app-footer">
    <p data-i18n-html="footer.sources">
      Data sources: <a href="https://www.fema.gov/flood-maps" target="_blank" rel="noopener noreferrer">FEMA Flood Maps</a>, <a href="https://usvi-open-data-portal-upenn.hub.arcgis.com" target="_blank" rel="noopener noreferrer">USVI Open Data Portal</a>.
    </p>
  </footer>

  <!-- Tutorial Modal -->
  <div id="tutorial-modal" class="tutorial-modal hidden" role="dialog" aria-modal="true" aria-labelledby="tutorial-modal-title">
    <div class="tutorial-modal__backdrop" data-tutorial-close></div>
    <div class="tutorial-modal__dialog">
      <h2 id="tutorial-modal-title" data-i18n="tutorial.title">Welcome to the Flood Risk Dashboard</h2>
      <div class="tutorial-modal__language">
        <p class="tutorial-modal__language-label" data-i18n="tutorial.languageLabel">Choose your language:</p>
        <div class="tutorial-modal__language-controls" role="group" data-i18n-aria-label="tutorial.languageLabel">
          <button type="button" class="tutorial-modal__language-button" data-language="en" data-i18n="tutorial.language.en">English</button>
          <button type="button" class="tutorial-modal__language-button" data-language="es" data-i18n="tutorial.language.es">Español</button>
          <button type="button" class="tutorial-modal__language-button" data-language="zh" data-i18n="tutorial.language.zh">中文</button>
        </div>
      </div>
      <div class="tutorial-modal__body" data-i18n-html="tutorial.body">
        <p>Click anywhere on the map to see the flood risk, the nearest shelter, and view flood insurance suggestions.</p>
      </div>
      <button type="button" class="tutorial-modal__action" data-tutorial-close data-i18n="tutorial.action">Got it</button>
    </div>
  </div>

  <!-- Calculation Details Modal -->
  <div id="calc-modal" class="calc-modal hidden" aria-hidden="true" role="dialog" aria-labelledby="calc-modal-title">
    <div class="calc-modal__backdrop" data-calc-close></div>
    <div class="calc-modal__dialog">
      <div class="calc-modal__header">
        <h3 id="calc-modal-title" data-i18n="calc.title">How We Estimate Flood Insurance</h3>
      </div>
      <div class="calc-modal__body" data-i18n-html="calc.body"></div>
      <div class="calc-modal__footer">
        <button class="calc-modal__action" type="button" data-calc-close data-i18n="buttons.close">Close</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/proj4@2.9.0/dist/proj4.js"></script>
  <script src="app.js" type="module"></script>
</body>
</html>
